# 모든 HTTP traffic (port 80) 을 HTTPS 트래픽 (port 443) 트래픽으로 리다이렉션 합니다

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # GCP Load Balancer 헬스 체크 예외 처리
    # GCP는 301 리다이렉트를 따라가지 않으므로 /health 는 직접 200 OK 반환
    location /health {
        access_log off;
        return 200 "OK";
        add_header Content-Type text/plain;
    }

    # 그 외 모든 HTTP 요청은 HTTPS로 리다이렉트
    return 301 https://$host$request_uri;
}
