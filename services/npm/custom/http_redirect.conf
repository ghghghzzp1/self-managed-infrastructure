# GCP Load Balancer SSL Termination 구성
#
# [아키텍처]
# 사용자(HTTPS) → GCP LB(SSL termination) → VM:80(HTTP) → NPM → 백엔드
#
# GCP LB가 SSL을 종료하므로 NPM은 LB로부터 HTTP를 수신함.
# HTTP→HTTPS 리다이렉트는 LB 레벨에서 처리되므로 NPM에서는 불필요하고 오히려 LB가
# 301을 받아버리는 문제를 야기함.
# 방화벽도 포트 80 직접 인터넷 접근을 차단(GCP LB IP만 허용)하므로 리다이렉트 불필요.

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # GCP Load Balancer 헬스 체크 응답
    # Terraform health check: port=80, path=/health, response="OK"
    location /health {
        access_log off;
        return 200 "OK";
        add_header Content-Type text/plain;
    }
}
