# service-b Backend API 직접 프록시 설정
# 외부 부하테스트(JMeter 등)에서 service-b-backend에 직접 접근하기 위한 설정
#
# 부하테스트 대상 엔드포인트:
#   POST /api/v1/auth/login
#   POST /api/v1/auth/register
#   GET  /api/v1/auth/profile/{user_id}
#   GET  /health
#   GET  /api/v1/health/vault
#   GET  /api/v1/health/database
#   GET  /api/v1/info
#   GET  /metrics  (Prometheus scrape)

server {
    listen 8082;
    server_name _;

    # 부하테스트용 timeout 설정
    proxy_connect_timeout   10s;
    proxy_read_timeout      30s;
    proxy_send_timeout      30s;

    proxy_buffering         off;

    location / {
        proxy_pass         http://service-b-backend:8000;
        proxy_http_version 1.1;
        proxy_set_header   Connection "";           # HTTP keepalive 활성화
        proxy_set_header   Host               $host;
        proxy_set_header   X-Real-IP          $remote_addr;
        proxy_set_header   X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto  $scheme;
    }
}
